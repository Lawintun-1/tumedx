<div class="max-w-3xl mx-auto p-4">
  <!-- Back button -->
  <button 
      hx-get="{{ url_for('student.learning_room', course_id=session.chapter.course_id) }}"
      hx-target="#content-wrapper"
      hx-swap="innerHTML"
      class="inline-flex items-center px-4 py-2 mb-4 text-sm font-medium text-indigo-600 
             bg-indigo-50 rounded-lg border border-indigo-200 shadow-sm 
             hover:bg-indigo-100 hover:text-indigo-800 transition duration-200"
  >
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
      </svg>
      Back to Chapter List
  </button>

  <h2 class="text-xl font-bold mb-4">{{ session.title }}</h2>

  <!-- ---------------- LEARNING SESSION ---------------- -->
  {% if session.session_type == "learning_session" %}
  <div class="space-y-4">
    {% for m in materials %}
      <div class="p-4 border rounded-lg bg-white shadow-sm">
        <h3 class="font-semibold">{{ m.name }}</h3>

        {% if m.type == "text" %}
          <p class="text-gray-700 mt-2">{{ m.content }}</p>

        {% elif m.type == "video" %}
          {% if "youtube.com/watch?v=" in m.content %}
            {% set video_id = m.content.split('v=')[-1].split('&')[0] %}
            <iframe src="https://www.youtube.com/embed/{{ video_id }}" class="w-full aspect-video mt-2 rounded" allowfullscreen></iframe>
          {% elif "youtu.be/" in m.content %}
            {% set video_id = m.content.split('/')[-1] %}
            <iframe src="https://www.youtube.com/embed/{{ video_id }}" class="w-full aspect-video mt-2 rounded" allowfullscreen></iframe>
          {% else %}
            <iframe src="{{ m.content }}" class="w-full aspect-video mt-2 rounded" allowfullscreen></iframe>
          {% endif %}

        {% elif m.type == "image" %}
          <img src="{{ m.content }}" alt="{{ m.name }}" class="mt-2 rounded-lg max-h-64 mx-auto">
        {% endif %}
      </div>
    {% endfor %}
  </div>

  <!-- Always show continue for learning sessions -->
  {% if next_session %}
    <div class="mt-6 text-right">
      <button 
          hx-get="{{ url_for('student.session_view', session_id=next_session.id) }}"
          hx-target="#content-wrapper"
          hx-swap="innerHTML"
          class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
      >
          Continue →
      </button>
    </div>
  {% endif %}
  {% endif %}

  <!-- ---------------- QUIZ SESSION ---------------- -->
  {% if session.session_type == "quiz_session" %}
  <div class="space-y-6">
    {% for quiz in quizzes %}
      <div class="p-4 border rounded-lg bg-white shadow-sm" id="quiz-{{ quiz.id }}">
        <h3 class="font-semibold text-lg">{{ quiz.name }}</h3>

        {% for qid, question in quiz.question.items() %}
          <div class="mt-4">
            <p class="font-medium">{{ qid }}. {{ question }}</p>

            {% if quiz.type in ["MCQ", "TF"] %}
              {% set opts = quiz.option[qid] %}
              <div class="mt-2 space-y-2">
                {% for opt in opts %}
                  <label class="flex items-center space-x-2">
                    <input type="radio" name="q{{ quiz.id }}_{{ qid }}" value="{{ opt }}" class="quiz-input text-indigo-600 focus:ring-indigo-500">
                    <span>{{ opt }}</span>
                  </label>
                {% endfor %}
              </div>
            {% elif quiz.type == "Blank" %}
              <div class="mt-2">
                <input 
                  type="text" 
                  name="q{{ quiz.id }}_{{ qid }}" 
                  placeholder="Type your answer..." 
                  class="quiz-input w-full border rounded-lg px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500"
                >
              </div>
            {% endif %}
          </div>
        {% endfor %}

        <!-- Check Button -->
        <div class="mt-4">
          <button 
            class="check-btn px-4 py-2 bg-indigo-400 text-white rounded-lg cursor-not-allowed opacity-50 transition"
            disabled
          >
            Check
          </button>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Continue (hidden until check is clicked) -->
  {% if next_session %}
    <div class="mt-6 text-right hidden" id="continue-wrapper">
      <button 
          hx-get="{{ url_for('student.session_view', session_id=next_session.id) }}"
          hx-target="#content-wrapper"
          hx-swap="innerHTML"
          class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
      >
          Continue →
      </button>
    </div>
  {% endif %}
  {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Enable Check only if answered
  document.querySelectorAll(".quiz-input").forEach(input => {
    input.addEventListener("input", () => {
      const parentQuiz = input.closest("[id^='quiz-']");
      const checkBtn = parentQuiz.querySelector(".check-btn");

      let answered = false;
      parentQuiz.querySelectorAll(".quiz-input").forEach(i => {
        if ((i.type === "radio" && i.checked) || (i.type === "text" && i.value.trim() !== "")) {
          answered = true;
        }
      });

      checkBtn.disabled = !answered;
      if (answered) {
        checkBtn.classList.remove("cursor-not-allowed", "opacity-50", "bg-indigo-400");
        checkBtn.classList.add("bg-indigo-500", "hover:bg-indigo-600");
      } else {
        checkBtn.classList.add("cursor-not-allowed", "opacity-50", "bg-indigo-400");
        checkBtn.classList.remove("bg-indigo-500", "hover:bg-indigo-600");
      }
    });
  });

  // After checking -> unlock continue
  document.querySelectorAll(".check-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      btn.disabled = true;
      btn.innerText = "Checked ✓";
      btn.classList.remove("bg-indigo-500", "hover:bg-indigo-600");
      btn.classList.add("bg-gray-400", "cursor-not-allowed");

      // Show Continue button
      document.getElementById("continue-wrapper").classList.remove("hidden");
    });
  });
});
</script>
