{% extends "includes/base.html" %}
{% import "includes/_macros.html" as macros %}

{% block title %}Create New Course{% endblock %}

{% block head_extras %}
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/all.min.css') }}">
    <style>
        /* Custom styles for dynamic content */
        .session-card {
            border: 2px solid #e2e8f0;
            padding: 1.5rem;
            margin-top: 1rem;
            border-radius: 0.75rem;
            position: relative;
        }
        .material-form-container, .question-form-container, .question-generator-container {
            border: 1px dashed #cbd5e0;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.5rem;
            position: relative;
            background-color: #f7fafc;
        }
        .remove-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 1.25rem;
            color: #ef4444;
            cursor: pointer;
            transition: color 0.2s;
        }
        .remove-button:hover {
            color: #dc2626;
        }
        .add-button {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: #4CAF50;
            color: white;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .add-button:hover {
            background-color: #45a049;
        }
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            position: relative;
        }
        .modal-buttons button {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        .modal-buttons button:hover {
            transform: scale(1.02);
        }
    </style>
{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row min-h-screen">
    <!-- Main Content Area -->
    <main class="flex-1 overflow-x-hidden overflow-y-auto p-6">
        <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Create New Course</h1>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="mb-4">
                        {% for category, message in messages %}
                            <div class="p-3 mb-2 rounded-md text-sm {% if category == 'danger' %}bg-red-100 text-red-700{% elif category == 'success' %}bg-green-100 text-green-700{% elif category == 'info' %}bg-blue-100 text-blue-700{% elif category == 'warning' %}bg-yellow-100 text-yellow-700{% endif %}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <form action="{{ url_for('teacher.create_course') }}" method="POST" class="space-y-6" id="create-course-form">
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700">Course Title</label>
                    <input type="text" id="title" name="title" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">Course Description</label>
                    <textarea id="description" name="description" rows="5"
                                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></textarea>
                </div>

                <!-- Course Sessions Section -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">Course Sessions</h3>
                        <button type="button" id="add-session-button"
                                class="flex items-center space-x-2 px-4 py-2 bg-indigo-500 text-white rounded-lg shadow-md hover:bg-indigo-600 transition duration-300">
                            <i class="fas fa-plus"></i>
                            <span>Add Session</span>
                        </button>
                    </div>
                    <div id="sessions-container" class="space-y-6">
                        <!-- Dynamic session forms will be added here -->
                    </div>
                </div>
                
                <!-- Hidden input to store the JSON data for sessions and materials -->
                <input type="hidden" name="sessions_json" id="sessions-json">

                <div class="mt-8">
                    <button type="submit"
                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">
                        Create Course
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Modal for adding session type -->
    <div id="session-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button type="button" id="close-modal-btn" class="remove-button"><i class="fas fa-times-circle"></i></button>
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Select Session Type</h2>
            <div class="modal-buttons space-y-4">
                <button type="button" id="add-learning-session-btn"
                        class="bg-green-500 text-white hover:bg-green-600">
                    <i class="fas fa-book-reader mr-3"></i> Add Learning Session
                </button>
                <button type="button" id="add-quiz-session-btn"
                        class="bg-purple-500 text-white hover:bg-purple-600">
                    <i class="fas fa-question-circle mr-3"></i> Add Quiz Session
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/create_course.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"> </script>
{% endblock %}

