<div id="content-wrapper" class="flex flex-col md:flex-row gap-6 p-4">

    <!-- Editor Panel -->
    <div class="flex-1 flex flex-col">
        <div class="flex items-center justify-between mb-2">
            <h1 class="text-xl md:text-2xl font-semibold text-gray-800">Code Editor</h1>
            <select id="language-select" class="px-2 py-1 border rounded shadow-sm">
                <option value="python">Python</option>
                <option value="clike">C++</option>
                <option value="java">Java</option> 
                <option value="javascript">JavaScript</option>
                <option value="php">PHP</option>
            </select>
        </div>

        <div class="flex-1 border rounded shadow-sm overflow-hidden" style="height: 400px;">
            <textarea id="code-editor" class="w-full h-full"></textarea>
        </div>

        <button
            id="run-btn"
            class="mt-3 px-4 py-2 bg-indigo-500 text-white font-medium rounded hover:bg-indigo-600 transition shadow"
        >
            Run Code
        </button>
    </div>

    <!-- Output Panel -->
    <div class="flex-1 flex flex-col">
        <h2 class="text-xl font-semibold mb-2 text-gray-800">Output</h2>
        <pre id="output" class="flex-1 p-4 border rounded shadow-sm bg-gray-100 overflow-auto break-words whitespace-pre-wrap"></pre>
    </div>
</div>

<script>
    // Initialize CodeMirror
    var myCodeMirror = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
        lineNumbers: true,
        mode: "python",
        theme: "default",
        viewportMargin: Infinity
    });

    const languageSelect = document.getElementById("language-select");
    const runBtn = document.getElementById("run-btn");
    const outputElement = document.getElementById("output");

    languageSelect.addEventListener("change", (e) => {
        const lang = e.target.value;
        let mode;
        if (lang === "clike") mode = "text/x-c++src";
        else mode = lang;
        myCodeMirror.setOption("mode", mode);
    });

    runBtn.addEventListener("click", async () => {
        const code = myCodeMirror.getValue();
        const lang = languageSelect.value;

        outputElement.textContent = "Running code...";

        try {
            const response = await fetch('/student/run', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code, lang })
            });

            if (!response.ok) throw new Error(`Server error: ${response.status}`);

            const data = await response.json();
            outputElement.textContent = data.output || "(No output)";
            outputElement.scrollTop = 0; // Reset scroll to top
        } catch (err) {
            outputElement.textContent = `Error: ${err.message}`;
        }
    });
</script>
